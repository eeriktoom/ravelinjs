<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ravelinjs script tag test</title>
    <link rel="stylesheet" href="../style.css" />
</head>
<body>
    <h2>Init</h2>
    RSA Public Key: <textarea id="rsaKey" rows="5">10001|B84498733A4CF477091B6D052129D4B528CB308B30B5567CAAF307608CF2F44D8ADC35191F45BB36A5ACBC191E8EAE6B1F2A80A2EC7F78815179A020246B1D6921EA9CADEE9C16B3FA33EF0183C6F13E3AE35BED0E4A84977B05A32C2C15EA5FEAC6BD594C83C0A226CC1776C26737E9B69E0B183F8F9184ADC44EC5751D1A863BD55E15A148C3B28D649B214890E8D0586AF5E982DB4559156EAA464C712FD7776E8C1C191BA67BA464973F4EB6F8BCEA08FB95EEE09EDAE6F4A8340C7A2833BFE905200488D896A8294A423A59B5058B03F1B82B6CCB6C4746BA297F7BD2D8494B36F02E0EDFF31CDBD73D6FA9BFE958BA58ACEE9CCDC87069C07DB8C6EC63</textarea>
    Publishable Token: <input id="pubToken" type="text" value="" />
    <button id="init">new Ravelin(cfg)</button>

    <h2>Encryption</h2>
    <div>
        Name on Card: <input type="text" id="name" /><br />
        Card Number: <input type="text" id="number" /><br />
        Month: <select id="month">
            <option selected value="1">January</option>
            <option value="2">February</option>
            <option value="3">March</option>
            <option value="4">April</option>
            <option value="5">May</option>
            <option value="6">June</option>
            <option value="7">July</option>
            <option value="8">August</option>
            <option value="9">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
        </select><br/>
        Year: <input type="number" id="year" /><br />

        <br/> <button id="encrypt" >ravelin.encrypt(card)</button>
    </div>

    <h2>Output</h2>
    <pre id="output"></pre>
    <h2>Output Error</h2>
    <pre id="error"></pre>

    <script src="./ravelin.js"></script>
    <script>
        var ravelin;

        document.getElementById('init').addEventListener('click', function() {
            run(function() {
                ravelin = new Ravelin({
                    rsaKey: document.getElementById('rsaKey').value,
                    publishableToken: document.getElementById('pubToken').value
                });
                return 'Initialised';
            });
        });

        document.getElementById('encrypt').addEventListener('click', function() {
            run(function() {
                var month = document.getElementById('month');
                return ravelin.encrypt.card({
                    rsaKey: document.getElementById('rsaKey').value, // FIXME Move to initialiser.
                    pan: document.getElementById('number').value,
                    nameOnCard: document.getElementById('name').value,
                    year: document.getElementById('year').value,
                    month: month.options[month.selectedIndex].value
                });
            });
        });

        function run(fn) {
            var out = document.getElementById('output'),
                err = document.getElementById('error');
            out.innerHTML = '';
            err.innerHTML = '';
            var t = out, m = '';
            try {
                m = JSON.stringify(fn());
            } catch (e) {
                m = e.name + ": " + e.message + "\nStack: " + e.stack;
                t = err;
            }
            t.appendChild(document.createTextNode(m));
        }
    </script>
</body>
</html>
